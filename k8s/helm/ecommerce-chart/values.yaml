# Configuración global
global:
  environment: dev
  # Registry configuration for production AKS deployment
  registry: ghcr.io
  imagePullPolicy: Always # Use Always for GHCR images in AKS
  
  # Image Pull Secrets for private GHCR registry
  imagePullSecrets:
    - name: ghcr-secret

# Configuración común para todos los microservicios
common:
  replicas: 1
  resources:
    limits:
      memory: "512Mi"
      cpu: "500m"
    requests:
      memory: "256Mi"
      cpu: "200m"

# Configuración de Zipkin (infraestructura)
zipkin:
  enabled: true
  image: openzipkin/zipkin
  port: 9411

# Definición de los microservicios
# Image tags can be overridden using image-tags.yaml file
microservices:
  - name: cloud-config
    isEureka: true
    image: nicolas-cm/cloud-config  # Will be prefixed with global.registry
    tag: latest  # Can be overridden via image-tags.yaml
    port: 9296
    type: ClusterIP
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "dev"
      - name: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "http://service-discovery:8761/eureka/"
      - name: SPRING_ZIPKIN_BASE_URL
        value: "http://zipkin:9411"

  - name: service-discovery
    isEureka: true
    image: nicolas-cm/service-discovery
    tag: latest
    port: 8761
    type: ClusterIP
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "dev"
      - name: SPRING_ZIPKIN_ENABLED
        value: "false"
      - name: SPRING_SLEUTH_ENABLED
        value: "false"
      - name: EUREKA_CLIENT_REGISTER_WITH_EUREKA
        value: "false"
      - name: EUREKA_CLIENT_FETCH_REGISTRY
        value: "false"

  - name: api-gateway
    image: nicolas-cm/api-gateway
    tag: latest
    port: 8080
    type: LoadBalancer
    nodePort: 30080
    contextPath: ""
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "dev"
      - name: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "http://service-discovery:8761/eureka/"
      - name: SPRING_CONFIG_IMPORT
        value: "optional:configserver:http://cloud-config:9296/"
      - name: SPRING_CLOUD_CONFIG_URI
        value: "http://cloud-config:9296"
      - name: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "false"
      - name: EUREKA_INSTANCE_HOSTNAME
        value: "api-gateway"
      - name: EUREKA_CLIENT_ENABLED
        value: "true"
      - name: EUREKA_CLIENT_FETCH_REGISTRY
        value: "true"
      - name: RIBBON_EUREKA_ENABLED
        value: "true"

  - name: product-service
    image: nicolas-cm/product-service
    tag: latest
    port: 8500
    type: ClusterIP
    contextPath: "/product-service"
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "dev"
      - name: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "http://service-discovery:8761/eureka/"
      - name: SPRING_CONFIG_IMPORT
        value: "optional:configserver:http://cloud-config:9296/"
      - name: SPRING_CLOUD_CONFIG_URI
        value: "http://cloud-config:9296"
      - name: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "false"
      - name: EUREKA_INSTANCE_HOSTNAME
        value: "product-service"
      - name: EUREKA_CLIENT_ENABLED
        value: "true"
      - name: EUREKA_CLIENT_FETCH_REGISTRY
        value: "true"
      - name: RIBBON_EUREKA_ENABLED
        value: "true"

  - name: order-service
    image: nicolas-cm/order-service
    tag: latest
    port: 8300
    type: ClusterIP
    contextPath: "/order-service"
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "dev"
      - name: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "http://service-discovery:8761/eureka/"
      - name: SPRING_CONFIG_IMPORT
        value: "optional:configserver:http://cloud-config:9296/"
      - name: SPRING_CLOUD_CONFIG_URI
        value: "http://cloud-config:9296"
      - name: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "false"
      - name: EUREKA_INSTANCE_HOSTNAME
        value: "order-service"
      - name: EUREKA_CLIENT_ENABLED
        value: "true"
      - name: EUREKA_CLIENT_FETCH_REGISTRY
        value: "true"
      - name: RIBBON_EUREKA_ENABLED
        value: "true"

  - name: user-service
    image: nicolas-cm/user-service
    tag: latest
    port: 8700
    type: ClusterIP
    contextPath: "/user-service"
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "dev"
      - name: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "http://service-discovery:8761/eureka/"
      - name: SPRING_CONFIG_IMPORT
        value: "optional:configserver:http://cloud-config:9296/"
      - name: SPRING_CLOUD_CONFIG_URI
        value: "http://cloud-config:9296"
      - name: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "false"
      - name: EUREKA_INSTANCE_HOSTNAME
        value: "user-service"
      - name: EUREKA_CLIENT_ENABLED
        value: "true"
      - name: EUREKA_CLIENT_FETCH_REGISTRY
        value: "true"
      - name: RIBBON_EUREKA_ENABLED
        value: "true"

  - name: payment-service
    image: nicolas-cm/payment-service
    tag: latest
    port: 8400
    type: ClusterIP
    contextPath: "/payment-service"
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "dev"
      - name: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "http://service-discovery:8761/eureka/"
      - name: SPRING_CONFIG_IMPORT
        value: "optional:configserver:http://cloud-config:9296/"
      - name: SPRING_CLOUD_CONFIG_URI
        value: "http://cloud-config:9296"
      - name: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "false"
      - name: EUREKA_INSTANCE_HOSTNAME
        value: "payment-service"
      - name: EUREKA_CLIENT_ENABLED
        value: "true"
      - name: EUREKA_CLIENT_FETCH_REGISTRY
        value: "true"
      - name: RIBBON_EUREKA_ENABLED
        value: "true"

  - name: shipping-service
    image: nicolas-cm/shipping-service
    tag: latest
    port: 8600
    type: ClusterIP
    contextPath: "/shipping-service"
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "dev"
      - name: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "http://service-discovery:8761/eureka/"
      - name: SPRING_CONFIG_IMPORT
        value: "optional:configserver:http://cloud-config:9296/"
      - name: SPRING_CLOUD_CONFIG_URI
        value: "http://cloud-config:9296"
      - name: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "false"
      - name: EUREKA_INSTANCE_HOSTNAME
        value: "shipping-service"
      - name: EUREKA_CLIENT_ENABLED
        value: "true"
      - name: EUREKA_CLIENT_FETCH_REGISTRY
        value: "true"
      - name: RIBBON_EUREKA_ENABLED
        value: "true"

  - name: favourite-service
    image: nicolas-cm/favourite-service
    tag: latest
    port: 8800
    type: ClusterIP
    contextPath: "/favourite-service"
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "dev"
      - name: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "http://service-discovery:8761/eureka/"
      - name: SPRING_CONFIG_IMPORT
        value: "optional:configserver:http://cloud-config:9296/"
      - name: SPRING_CLOUD_CONFIG_URI
        value: "http://cloud-config:9296"
      - name: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "false"
      - name: EUREKA_INSTANCE_HOSTNAME
        value: "favourite-service"
      - name: EUREKA_CLIENT_ENABLED
        value: "true"
      - name: EUREKA_CLIENT_FETCH_REGISTRY
        value: "true"
      - name: RIBBON_EUREKA_ENABLED
        value: "true"

  - name: proxy-client
    image: nicolas-cm/proxy-client
    tag: latest
    port: 8900
    type: ClusterIP
    contextPath: "/app"
    env:
      - name: SPRING_PROFILES_ACTIVE
        value: "dev"
      - name: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "http://service-discovery:8761/eureka/"
      - name: SPRING_CONFIG_IMPORT
        value: "optional:configserver:http://cloud-config:9296/"
      - name: SPRING_CLOUD_CONFIG_URI
        value: "http://cloud-config:9296"
      - name: EUREKA_INSTANCE_PREFER_IP_ADDRESS
        value: "false"
      - name: EUREKA_INSTANCE_HOSTNAME
        value: "proxy-client"
      - name: EUREKA_CLIENT_ENABLED
        value: "true"
      - name: EUREKA_CLIENT_FETCH_REGISTRY
        value: "true"
      - name: RIBBON_EUREKA_ENABLED
        value: "true"
